<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>💪 تطبيق اللياقة البدنية الاحترافي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for gradients, shadows, and fonts */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font for a modern look */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); /* Purple gradient */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto; /* Allow scrolling for content that exceeds viewport height */
        }
        /* Hide scrollbar for a cleaner look */
        body::-webkit-scrollbar {
            display: none;
        }
        body {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* Custom spinner animation */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #667eea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-500 to-purple-600 min-h-screen flex items-center justify-center p-4">
    <div class="container bg-white p-8 rounded-2xl shadow-xl max-w-lg w-full">
        <div id="abdominalExercisesPage" class="page">
            <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-8 flex items-center justify-center gap-2">
                💪 تمارين البطن <span class="text-indigo-500">لشباب أقوى</span>
            </h1>

            <p class="text-center text-gray-600 mb-8">
                ابدأ رحلتك نحو بطن مشدودة وقوية مع هذه التمارين الفعالة!
            </p>

            <div class="grid grid-cols-1 gap-6">
                <div class="bg-gray-50 p-4 rounded-lg shadow-sm flex items-center gap-4 border-r-4 border-indigo-400">
                    <img src="https://placehold.co/80x80/E0E7FF/4F46E5?text=CR" alt="تمرين الكرش" class="rounded-full w-20 h-20 object-cover">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1">تمرين الكرش (Crunches) 🤸‍♂️</h3>
                        <p class="text-gray-600 text-sm">
                            تمرين أساسي يستهدف عضلات البطن العلوية. استلقِ على ظهرك، اثنِ ركبتيك، ارفع جذعك نحو ركبتيك.
                        </p>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg shadow-sm flex items-center gap-4 border-r-4 border-purple-400">
                    <img src="https://placehold.co/80x80/EDE9FE/7C3AED?text=PL" alt="تمرين البلانك" class="rounded-full w-20 h-20 object-cover">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1">تمرين البلانك (Plank) ⏱️</h3>
                        <p class="text-gray-600 text-sm">
                            يقوي الجسم بالكامل، خاصة عضلات البطن والظهر. حافظ على جسمك مستقيماً مثل اللوح الخشبي.
                        </p>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg shadow-sm flex items-center gap-4 border-r-4 border-green-400">
                    <img src="https://placehold.co/80x80/D1FAE5/10B981?text=LR" alt="رفع الساقين" class="rounded-full w-20 h-20 object-cover">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1">رفع الساقين (Leg Raises) 🦵</h3>
                        <p class="text-gray-600 text-sm">
                            يستهدف عضلات البطن السفلية. استلقِ على ظهرك وارفع ساقيك معاً ببطء.
                        </p>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg shadow-sm flex items-center gap-4 border-r-4 border-yellow-400">
                    <img src="https://placehold.co/80x80/FFFBEB/F59E0B?text=RT" alt="التويست الروسي" class="rounded-full w-20 h-20 object-cover">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1">التويست الروسي (Russian Twists) 🔄</h3>
                        <p class="text-gray-600 text-sm">
                            يقوي عضلات البطن الجانبية (المائلة). اجلس على الأرض، ارفع قدميك قليلاً، ولف جذعك من جانب لآخر.
                        </p>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg shadow-sm flex items-center gap-4 border-r-4 border-red-400">
                    <img src="https://placehold.co/80x80/FEE2E2/EF4444?text=BC" alt="تمرين الدراجة" class="rounded-full w-20 h-20 object-cover">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1">تمرين الدراجة (Bicycle Crunches) 🚴</h3>
                        <p class="text-gray-600 text-sm">
                            تمرين شامل للبطن يستهدف العضلات العلوية والسفلية والمائلة. حرك ساقيك كأنك تقود دراجة.
                        </p>
                    </div>
                </div>
            </div>

            <button id="goToCalculatorBtn" class="w-full p-4 mt-8 bg-gradient-to-r from-indigo-600 to-purple-700 text-white font-bold rounded-lg shadow-lg hover:from-indigo-700 hover:to-purple-800 transition duration-300 transform hover:-translate-y-1">
                انتقل إلى حاسبة السعرات الحرارية ✨
            </button>
        </div>

        <div id="calorieCalculatorPage" class="page hidden">
            <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-8 flex items-center justify-center gap-2">
                🔥 حاسبة السعرات الحرارية <span class="text-indigo-500">الاحترافية</span>
            </h1>
            
            <form id="calorieForm" class="space-y-6">
                <div class="form-group">
                    <label for="gender" class="block text-gray-700 font-semibold mb-2">
                        🚻 الجنس:
                    </label>
                    <select id="gender" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-indigo-500 transition duration-300">
                        <option value="">اختر الجنس</option>
                        <option value="male">ذكر ♂️</option>
                        <option value="female">أنثى ♀️</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="age" class="block text-gray-700 font-semibold mb-2">
                        🎂 العمر (سنة):
                    </label>
                    <input type="number" id="age" min="15" max="80" required 
                           class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-indigo-500 transition duration-300"
                           placeholder="مثال: 25">
                </div>
                
                <div class="form-group">
                    <label for="weight" class="block text-gray-700 font-semibold mb-2">
                        ⚖️ الوزن (كيلوجرام):
                    </label>
                    <input type="number" id="weight" min="30" max="300" step="0.1" required 
                           class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-indigo-500 transition duration-300"
                           placeholder="مثال: 70.5">
                </div>
                
                <div class="form-group">
                    <label for="height" class="block text-gray-700 font-semibold mb-2">
                        📏 الطول (سنتيمتر):
                    </label>
                    <input type="number" id="height" min="140" max="220" required 
                           class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-indigo-500 transition duration-300"
                           placeholder="مثال: 175">
                </div>
                
                <div class="form-group">
                    <label for="activity" class="block text-gray-700 font-semibold mb-2">
                        🏃 مستوى النشاط:
                    </label>
                    <select id="activity" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-indigo-500 transition duration-300">
                        <option value="">اختر مستوى النشاط</option>
                        <option value="1.2">قليل الحركة (لا توجد تمارين) 🛋️</option>
                        <option value="1.375">نشاط خفيف (تمارين خفيفة 1-3 أيام/أسبوع) 🚶</option>
                        <option value="1.55">نشاط متوسط (تمارين معتدلة 3-5 أيام/أسبوع) 🏋️</option>
                        <option value="1.725">نشاط عالي (تمارين شاقة 6-7 أيام/أسبوع) 🏃‍♂️</option>
                        <option value="1.9">نشاط فائق (تمارين صعبة جداً أو عمل جسدي) 🚀</option>
                    </select>
                </div>
                
                <button type="submit" class="w-full p-4 bg-gradient-to-r from-indigo-600 to-purple-700 text-white font-bold rounded-lg shadow-lg hover:from-indigo-700 hover:to-purple-800 transition duration-300 transform hover:-translate-y-1">
                    احسب السعرات الحرارية ✨
                </button>
            </form>
            
            <div id="results" class="results mt-8 p-6 bg-gray-50 rounded-xl shadow-inner hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">📊 النتائج:</h2>
                
                <div id="bmi" class="result-item flex justify-between items-center bg-blue-50 p-3 rounded-md mb-3 border-r-4 border-blue-400">
                    <span class="text-gray-700 font-medium">مؤشر كتلة الجسم (BMI):</span>
                    <strong id="bmiValue" class="text-blue-700 text-lg"></strong>
                </div>

                <div id="bmr" class="result-item flex justify-between items-center bg-blue-50 p-3 rounded-md mb-3 border-r-4 border-blue-400">
                    <span class="text-gray-700 font-medium">معدل الأيض الأساسي (BMR):</span>
                    <strong id="bmrValue" class="text-blue-700 text-lg"></strong>
                </div>
                <div id="maintenance" class="result-item flex justify-between items-center bg-green-50 p-3 rounded-md mb-3 border-r-4 border-green-400">
                    <span class="text-gray-700 font-medium">للحفاظ على الوزن:</span>
                    <strong id="maintenanceValue" class="text-green-700 text-lg"></strong>
                </div>
                <div id="mildLoss" class="result-item flex justify-between items-center bg-yellow-50 p-3 rounded-md mb-3 border-r-4 border-yellow-400">
                    <span class="text-gray-700 font-medium">لفقدان وزن خفيف (0.25 كجم/أسبوع):</span>
                    <strong id="mildLossValue" class="text-yellow-700 text-lg"></strong>
                </div>
                <div id="moderateLoss" class="result-item flex justify-between items-center bg-orange-50 p-3 rounded-md mb-3 border-r-4 border-orange-400">
                    <span class="text-gray-700 font-medium">لفقدان الوزن (0.5 كجم/أسبوع):</span>
                    <strong id="moderateLossValue" class="text-orange-700 text-lg"></strong>
                </div>
                <div id="severeLoss" class="result-item flex justify-between items-center bg-red-50 p-3 rounded-md mb-3 border-r-4 border-red-400">
                    <span class="text-gray-700 font-medium">لفقدان وزن سريع (1 كجم/أسبوع):</span>
                    <strong id="severeLossValue" class="text-red-700 text-lg"></strong>
                </div>
                <div id="mildGain" class="result-item flex justify-between items-center bg-pink-50 p-3 rounded-md mb-3 border-r-4 border-pink-400">
                    <span>لزيادة الوزن (0.5 كجم/أسبوع):</span>
                    <strong id="mildGainValue" class="text-pink-700 text-lg"></strong>
                </div>

                <div id="aiAdviceSection" class="mt-8 p-6 bg-purple-50 rounded-xl border-2 border-purple-200 shadow-md">
                    <h3 class="text-xl font-bold text-purple-800 mb-4 text-center flex items-center justify-center gap-2">
                        💡 نصائح الذكاء الاصطناعي المخصصة لك:
                    </h3>
                    <div id="aiLoading" class="flex justify-center items-center gap-2 text-purple-600 hidden">
                        <div class="spinner"></div>
                        <span>جاري توليد النصائح...</span>
                    </div>
                    <div id="aiError" class="text-red-600 text-center hidden">
                        عذراً، حدث خطأ أثناء جلب النصائح. يرجى المحاولة مرة أخرى.
                    </div>
                    <div id="aiAdviceContent" class="text-gray-700 leading-relaxed text-right">
                        </div>
                </div>

                <p class="text-sm text-gray-500 mt-6 text-center">
                    ⚠️ هذه الحسابات هي تقديرية. للحصول على خطة صحية شخصية، يرجى استشارة أخصائي تغذية أو طبيب.
                </p>
                <button id="goToAbdominalBtn" class="w-full p-4 mt-8 bg-gradient-to-r from-gray-600 to-gray-700 text-white font-bold rounded-lg shadow-lg hover:from-gray-700 hover:to-gray-800 transition duration-300 transform hover:-translate-y-1">
                    العودة لتمارين البطن 🔙
                </button>
            </div>
        </div>
    </div>

    <script>
        // Get references to HTML elements for pages
        const abdominalExercisesPage = document.getElementById('abdominalExercisesPage');
        const calorieCalculatorPage = document.getElementById('calorieCalculatorPage');
        const goToCalculatorBtn = document.getElementById('goToCalculatorBtn');
        const goToAbdominalBtn = document.getElementById('goToAbdominalBtn');

        // Get references to HTML elements for calorie calculator
        const calorieForm = document.getElementById('calorieForm');
        const resultsDiv = document.getElementById('results');
        const bmrValue = document.getElementById('bmrValue');
        const maintenanceValue = document.getElementById('maintenanceValue');
        const mildLossValue = document.getElementById('mildLossValue');
        const moderateLossValue = document.getElementById('moderateLossValue');
        const severeLossValue = document.getElementById('severeLossValue');
        const mildGainValue = document.getElementById('mildGainValue');
        const bmiValue = document.getElementById('bmiValue');
        const aiAdviceSection = document.getElementById('aiAdviceSection');
        const aiLoading = document.getElementById('aiLoading');
        const aiError = document.getElementById('aiError');
        const aiAdviceContent = document.getElementById('aiAdviceContent');

        // Function to show a specific page and hide others
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                if (page.id === pageId) {
                    page.classList.remove('hidden');
                } else {
                    page.classList.add('hidden');
                }
            });
        }

        // Event listeners for page navigation buttons
        goToCalculatorBtn.addEventListener('click', () => showPage('calorieCalculatorPage'));
        goToAbdominalBtn.addEventListener('click', () => showPage('abdominalExercisesPage'));

        // Initially show the abdominal exercises page
        showPage('abdominalExercisesPage');

        // Add event listener for calorie form submission
        calorieForm.addEventListener('submit', async function(e) {
            e.preventDefault(); // Prevent default form submission (page reload)
            
            // Get input values from the calorie calculator form
            const gender = document.getElementById('gender').value;
            const age = parseFloat(document.getElementById('age').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const activity = parseFloat(document.getElementById('activity').value);
            
            // Calculate Basal Metabolic Rate (BMR) using Mifflin-St Jeor equation
            // BMR: calories burned at rest to maintain basic bodily functions
            let bmr;
            if (gender === 'male') {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }
            
            // Calculate total daily energy expenditure (TDEE) based on activity level
            const maintenance = bmr * activity; // Calories to maintain current weight
            
            // Calculate calorie targets for weight management
            // Approximations based on 7700 calories per 1 kg of fat
            const mildLoss = maintenance - 250; // ~0.25 kg/week loss
            const moderateLoss = maintenance - 500; // ~0.5 kg/week loss
            const severeLoss = maintenance - 1000; // ~1 kg/week loss (consult professional)
            const mildGain = maintenance + 500; // ~0.5 kg/week gain
            
            // Calculate Body Mass Index (BMI)
            // BMI = weight (kg) / (height (m))^2
            const heightInMeters = height / 100;
            const bmi = weight / (heightInMeters * heightInMeters);

            // Display results
            bmrValue.textContent = `${Math.round(bmr)} سعرة حرارية`;
            maintenanceValue.textContent = `${Math.round(maintenance)} سعرة حرارية`;
            mildLossValue.textContent = `${Math.round(mildLoss)} سعرة حرارية`;
            moderateLossValue.textContent = `${Math.round(moderateLoss)} سعرة حرارية`;
            severeLossValue.textContent = `${Math.round(severeLoss)} سعرة حرارية`;
            mildGainValue.textContent = `${Math.round(mildGain)} سعرة حرارية`;
            
            // Display BMI with interpretation
            let bmiInterpretation = '';
            if (bmi < 18.5) {
                bmiInterpretation = ' (نقص الوزن 📉)';
            } else if (bmi >= 18.5 && bmi < 24.9) {
                bmiInterpretation = ' (وزن صحي ✅)';
            } else if (bmi >= 25 && bmi < 29.9) {
                bmiInterpretation = ' (زيادة الوزن ⚠️)';
            } else {
                bmiInterpretation = ' (سمنة 🚨)';
            }
            bmiValue.textContent = `${bmi.toFixed(2)}${bmiInterpretation}`;

            resultsDiv.classList.remove('hidden'); // Show results section

            // --- AI Advice Generation ---
            // Clear previous AI advice and show loading spinner
            aiAdviceContent.innerHTML = '';
            aiError.classList.add('hidden');
            aiLoading.classList.remove('hidden');
            aiAdviceSection.classList.remove('hidden'); // Ensure AI section is visible

            try {
                // Construct the prompt for the AI model
                const prompt = `أنت خبير تغذية ولياقة بدنية. بناءً على المعلومات التالية، قدم نصائح شخصية وشاملة لنمط حياة صحي، مع التركيز على التغذية والتمارين الرياضية، بالإضافة إلى رسالة تحفيزية. اجعل النصائح مناسبة للشباب.
                
                معلومات المستخدم:
                - الجنس: ${gender === 'male' ? 'ذكر' : 'أنثى'}
                - العمر: ${age} سنة
                - الوزن: ${weight} كجم
                - الطول: ${height} سم
                - مستوى النشاط: ${document.getElementById('activity').options[document.getElementById('activity').selectedIndex].text.split('(')[0].trim()} (معامل ${activity})
                - مؤشر كتلة الجسم (BMI): ${bmi.toFixed(2)} ${bmiInterpretation}
                - معدل الأيض الأساسي (BMR): ${Math.round(bmr)} سعرة حرارية
                - سعرات الحفاظ على الوزن: ${Math.round(maintenance)} سعرة حرارية
                - سعرات فقدان وزن خفيف (0.25 كجم/أسبوع): ${Math.round(mildLoss)} سعرة حرارية
                - سعرات فقدان الوزن (0.5 كجم/أسبوع): ${Math.round(moderateLoss)} سعرة حرارية
                - سعرات فقدان وزن سريع (1 كجم/أسبوع): ${Math.round(severeLoss)} سعرة حرارية
                - سعرات زيادة الوزن (0.5 كجم/أسبوع): ${Math.round(mildGain)} سعرة حرارية

                قدم نصائحك في الأقسام التالية:
                1.  **نظرة عامة على صحتك:** تحليل موجز لوضعهم بناءً على BMI والسعرات الحرارية.
                2.  **نصائح التغذية:** بناءً على سعرات الحفاظ على الوزن وفقدان/زيادة الوزن.
                3.  **نصائح التمارين:** توصيات عامة للنشاط البدني.
                4.  **رسالة تحفيزية:** تشجيع على الاستمرارية.
                
                اجعل الرد موجزًا وواضحًا ومقسمًا إلى نقاط باستخدام تنسيق Markdown.`;

                // Prepare chat history for the API call
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = { contents: chatHistory };
                const apiKey = ""; // API key will be provided by the Canvas environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                // Make the API call to Gemini
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json(); // Parse the JSON response

                // Check if the response contains valid content
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const aiText = result.candidates[0].content.parts[0].text;
                    aiAdviceContent.innerHTML = formatMarkdownToHtml(aiText); // Display AI advice
                } else {
                    aiError.classList.remove('hidden'); // Show error if no content
                    console.error('AI response structure unexpected:', result);
                }

            } catch (error) {
                aiError.classList.remove('hidden'); // Show error on API call failure
                console.error('Error fetching AI advice:', error);
            } finally {
                aiLoading.classList.add('hidden'); // Hide loading spinner
            }
        });

        // Helper function to convert basic markdown to HTML for display
        function formatMarkdownToHtml(markdownText) {
            let html = markdownText;
            // Convert bold text
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            // Convert headings (assuming ## or ### for simplicity, can be expanded)
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            // Convert lists
            html = html.replace(/^\* (.*$)/gim, '<li>$1</li>');
            html = html.replace(/^(?!<li|<\/li>)(.+)$/gim, '<p>$1</p>'); // Wrap remaining lines in paragraphs

            // Basic cleanup for markdown list conversion
            html = html.replace(/<\/li>\n<li>/g, '</li><li>');
            html = html.replace(/<\/ul><ul>/g, ''); // Prevent multiple ul tags if markdown has multiple lists

            // Replace newlines with <br> for general text, but not inside block elements
            html = html.replace(/(?<!<\/h[1-6]>)(?<!<\/li>)(?<!<\/p>)\n(?!<h[1-6]>)(?!<li>)(?!<p>)/g, '<br>');

            return html;
        }
    </script>
</body>
</html>
